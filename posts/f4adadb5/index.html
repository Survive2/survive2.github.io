<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="h1J4cker&#39;s Blog" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>CSAPP-Bomb-Lab |  h1J4cker&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/images/h1J4cker.png" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FTH4BWMNR9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FTH4BWMNR9');
</script>

 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-CSAPP-Bomb-Lab"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  CSAPP-Bomb-Lab
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/f4adadb5/" class="article-date">
  <time datetime="2022-07-10T13:40:08.000Z" itemprop="datePublished">2022-07-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/CSAPP/">CSAPP</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">6.7k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">30 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      



  
    <div class="article-entry" itemprop="articleBody">
       
  <ul>
<li><strong>实验整体分析</strong></li>
</ul>
<p>实验是基于Linux x86-64的，其中bomb文件是一个64位的可执行程序，bomb.c文件是一个C语言程序，其中包含了main函数以及其他许多函数。该实验共包含**六个关卡(Phase_1-Phase_6)**，每一关需要我们正确的输入密码，才能不引爆炸弹，并进行下一关。</p>
<p>这就需要需要我们通过对可执行文件<strong>bomb</strong>进行逆向分析，在其中寻找出正确答案，从而过关。此实验需要汇编基础，并配合gdb完成。（不会用gdb的请看我的实验指南文件，里面有gdb命令文档）<span id="more"></span></p>
<ul>
<li><strong>Phase_1分析</strong></li>
</ul>
<p>我们使用<code>gdb bomb</code>命令进入程序，进入后在phase_1的函数入口处打上断点 命令为：<code>b phase_1</code>，进入后输入<code>r</code>是程序运行会出现如下语句：<code>Welcome to my fiendish little bomb. You have 6 phases with which to blow yourself up. Have a nice day!</code>即表示运行成功。</p>
<p>此时我们随意输入任意值，便会触发断点。会出现一大堆东西，看着很复杂，但是我们不用慌，此时我们输入<code>disassemble phase_1</code>这个命令，便可以对phase_1进行反汇编，会在屏幕上显示出phase_1的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400ee0 &lt;+0&gt;:     sub    rsp,0x8</span><br><span class="line">   0x0000000000400ee4 &lt;+4&gt;:     mov    esi,0x402400</span><br><span class="line">   0x0000000000400ee9 &lt;+9&gt;:     call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000400eee &lt;+14&gt;:    test   eax,eax</span><br><span class="line">   0x0000000000400ef0 &lt;+16&gt;:    je     0x400ef7 &lt;phase_1+23&gt;</span><br><span class="line">   0x0000000000400ef2 &lt;+18&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400ef7 &lt;+23&gt;:    add    rsp,0x8</span><br><span class="line">   0x0000000000400efb &lt;+27&gt;:    ret</span><br></pre></td></tr></table></figure>


<p>这里我们可以发现，由于是64位，</p>
<ul>
<li><p>第一行的栈顶指针<strong>从esp变为了rsp</strong></p>
</li>
<li><p>第二行对esi（既rsi的低32位）赋了一个地址：<strong>0x402400</strong>，由于是64位的程序，前六个参数在寄存器中，所以<strong>rsi的低32位（既esi的值）</strong>作为参数传给了后面的<code>strings_not_equal</code>的函数</p>
</li>
<li><p>在第三行call了一个函数，该函数名为<code>strings_not_equal</code>，可以使用命令<code>disassemble strings_not_equal</code>查看该函数汇编，可以发现该函数是用来比较<strong>用户输入的字符串和esi中的值是否相等</strong>，若相等则过关，不相等就会引爆炸弹</p>
</li>
</ul>
<p>分析到这里，第一关的答案就很明显了，第一关我们需要的密码就是<strong>esi中的那个地址中（0x402400）存放的值</strong>，那我们使用命令<code>x/s 0x402400</code>即可查看其中的值</p>
<p>Phase_1答案：Border relations with Canada have never been better.</p>
<ul>
<li><strong>Phase_2分析</strong></li>
</ul>
<p>我们此时继续输入<code>disassemble phase_2</code>命令来对Phase_2进行反汇编，汇编代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400efc &lt;+0&gt;:     push   rbp</span><br><span class="line">   0x0000000000400efd &lt;+1&gt;:     push   rbx</span><br><span class="line">   0x0000000000400efe &lt;+2&gt;:     sub    rsp,0x28</span><br><span class="line">   0x0000000000400f02 &lt;+6&gt;:     mov    rsi,rsp</span><br><span class="line">   0x0000000000400f05 &lt;+9&gt;:     call   0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000400f0a &lt;+14&gt;:    cmp    DWORD PTR [rsp],0x1</span><br><span class="line">   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f10 &lt;+20&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f15 &lt;+25&gt;:    jmp    0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f17 &lt;+27&gt;:    mov    eax,DWORD PTR [rbx-0x4]</span><br><span class="line">   0x0000000000400f1a &lt;+30&gt;:    add    eax,eax</span><br><span class="line">   0x0000000000400f1c &lt;+32&gt;:    cmp    DWORD PTR [rbx],eax</span><br><span class="line">   0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400f20 &lt;+36&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f25 &lt;+41&gt;:    add    rbx,0x4</span><br><span class="line">   0x0000000000400f29 &lt;+45&gt;:    cmp    rbx,rbp</span><br><span class="line">   0x0000000000400f2c &lt;+48&gt;:    jne    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f2e &lt;+50&gt;:    jmp    0x400f3c &lt;phase_2+64&gt;</span><br><span class="line">   0x0000000000400f30 &lt;+52&gt;:    lea    rbx,[rsp+0x4]</span><br><span class="line">   0x0000000000400f35 &lt;+57&gt;:    lea    rbp,[rsp+0x18]</span><br><span class="line">   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f3c &lt;+64&gt;:    add    rsp,0x28</span><br><span class="line">   0x0000000000400f40 &lt;+68&gt;:    pop    rbx</span><br><span class="line">   0x0000000000400f41 &lt;+69&gt;:    pop    rbp</span><br><span class="line">   0x0000000000400f42 &lt;+70&gt;:    ret</span><br></pre></td></tr></table></figure>

<p>阅读代码后可以发现</p>
<ul>
<li><p><code>0x0000000000400f05 &lt;+9&gt;:     call   0x40145c &lt;read_six_numbers&gt;</code>这个地方进行了函数调用，读入了六个数字。</p>
</li>
<li><p>对<code>Phase_2 &lt;+14&gt;</code>的分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f0a &lt;+14&gt;:    cmp    DWORD PTR [rsp],0x1</span><br><span class="line">   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f10 &lt;+20&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>这三句话的作用为<strong>将rsp指向的值与0x1</strong>进行比较，如果不相等就会引爆炸弹，如果相等，则会<strong>跳到<code>Phase_2 &lt;+52&gt;</code>的位置</strong>,而rsp的值为我们的输入</p>
</li>
</ul>
<p>也就是说为了不引爆炸弹，我们的第一个数字必须为1</p>
<ul>
<li>对<code>Phase_2 &lt;+52&gt;</code>的分析</li>
</ul>
<p>可以看见该位置及其往后的两段代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f30 &lt;+52&gt;:    lea    rbx,[rsp+0x4]</span><br><span class="line">   0x0000000000400f35 &lt;+57&gt;:    lea    rbp,[rsp+0x18]</span><br><span class="line">   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;</span><br></pre></td></tr></table></figure>

<p>+52的位置<strong>将rsp+0x4处的值</strong>给了rbx，+57的位置<strong>将rsp+0x18处的值给了rbp</strong>，这两句执行完以后跳转到了<code>Phase_2&lt;+27&gt;</code>的位置。<strong>注意</strong>：我们输入的第一个数字在rsp中，而整数占4个字节，也就是说rsp+0x4的位置存放的正是我们输入的第二个数字，请记住这一点，在后面的分析中非常重要</p>
<ul>
<li>对<code>Phase_2&lt;+27&gt;</code>的分析</li>
</ul>
<p>我们关注一下这四句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f17 &lt;+27&gt;:    mov    eax,DWORD PTR [rbx-0x4]</span><br><span class="line">  0x0000000000400f1a &lt;+30&gt;:    add    eax,eax</span><br><span class="line">  0x0000000000400f1c &lt;+32&gt;:    cmp    DWORD PTR [rbx],eax</span><br><span class="line">  0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">  0x0000000000400f20 &lt;+36&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>

<p>+27的位置<strong>将rbx-0x4处的值</strong>给了eax，然后+30的位置，将eax里的值乘了2，并与rbx里的值进行比较，若相等则跳到<code>Phase_2 &lt;+41&gt;</code>的位置，不相等就会引爆炸弹。</p>
<p>而再看我们前面对于<code>Phase_2 &lt;+52&gt;</code>的分析，可以发现，<strong>rbx里的值是rsp+0x4处的值</strong>，也就是说rbx里的值为我们输入的第二个值，那么rbx-0x4存的就是我们输入的第一个值。</p>
<p>那么这里的四句话的作用就很明显了，既将我们现在输入的值与前一个输入的值乘以2来进行比较，若不相等，则炸弹被引爆，若相等则跳到<code>Phase_2 &lt;+41&gt;</code>的位置</p>
<ul>
<li>对<code>Phase_2&lt;+41&gt;</code>的分析</li>
</ul>
<p>在+41的位置我们可以看见这里使rbx&#x3D;rbx+0x4，既现在rbx里的值，是我们输入的第三个值，然后进行了一个比较以后，若没通过则回到<code>Phase_2&lt;+27&gt;</code>的位置，那么可以看出，这是一个循环，这个循环的作用是确保<strong>后一个输入的值为前一个输入乘以2</strong>。</p>
<p>那么再回到我们最开始对于<code>Phase_2 &lt;+14&gt;</code>的分析，可以得知：输入的第一个值必须为1，且需要输入六个数字，每一个数字的值要等于前一个数字乘以2，那么Phase_2的密码就很明显了。</p>
<p>Phase_2的答案为：1 2 4 8 16 32</p>
<ul>
<li><strong>Phase_3分析</strong></li>
</ul>
<p>同样，输入命令：<code>disassemble phase_3</code>即可得到phase_3的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f43 &lt;+0&gt;:     sub    rsp,0x18</span><br><span class="line">   0x0000000000400f47 &lt;+4&gt;:     lea    rcx,[rsp+0xc]</span><br><span class="line">   0x0000000000400f4c &lt;+9&gt;:     lea    rdx,[rsp+0x8]</span><br><span class="line">   0x0000000000400f51 &lt;+14&gt;:    mov    esi,0x4025cf</span><br><span class="line">   0x0000000000400f56 &lt;+19&gt;:    mov    eax,0x0</span><br><span class="line">   0x0000000000400f5b &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000400f60 &lt;+29&gt;:    cmp    eax,0x1</span><br><span class="line">   0x0000000000400f63 &lt;+32&gt;:    jg     0x400f6a &lt;phase_3+39&gt;</span><br><span class="line">   0x0000000000400f65 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f6a &lt;+39&gt;:    cmp    DWORD PTR [rsp+0x8],0x7</span><br><span class="line">   0x0000000000400f6f &lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;</span><br><span class="line">   0x0000000000400f71 &lt;+46&gt;:    mov    eax,DWORD PTR [rsp+0x8]</span><br><span class="line">   0x0000000000400f75 &lt;+50&gt;:    jmp    QWORD PTR [rax*8+0x402470]</span><br><span class="line">   0x0000000000400f7c &lt;+57&gt;:    mov    eax,0xcf</span><br><span class="line">   0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f83 &lt;+64&gt;:    mov    eax,0x2c3</span><br><span class="line">   0x0000000000400f88 &lt;+69&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f8a &lt;+71&gt;:    mov    eax,0x100</span><br><span class="line">   0x0000000000400f8f &lt;+76&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f91 &lt;+78&gt;:    mov    eax,0x185</span><br><span class="line">   0x0000000000400f96 &lt;+83&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f98 &lt;+85&gt;:    mov    eax,0xce</span><br><span class="line">   0x0000000000400f9d &lt;+90&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f9f &lt;+92&gt;:    mov    eax,0x2aa</span><br><span class="line">   0x0000000000400fa4 &lt;+97&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fa6 &lt;+99&gt;:    mov    eax,0x147</span><br><span class="line">   0x0000000000400fab &lt;+104&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fad &lt;+106&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fb2 &lt;+111&gt;:   mov    eax,0x0</span><br><span class="line">   0x0000000000400fb7 &lt;+116&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fb9 &lt;+118&gt;:   mov    eax,0x137</span><br><span class="line">   0x0000000000400fbe &lt;+123&gt;:   cmp    eax,DWORD PTR [rsp+0xc]</span><br><span class="line">   0x0000000000400fc2 &lt;+127&gt;:   je     0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">   0x0000000000400fc4 &lt;+129&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fc9 &lt;+134&gt;:   add    rsp,0x18</span><br><span class="line">   0x0000000000400fcd &lt;+138&gt;:   ret</span><br></pre></td></tr></table></figure>

<ul>
<li>阅读代码可以发现程序使用户在<br><code>0x0000000000400f5b &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</code>这里进行了输入</li>
</ul>
<p>那我们接着往下看会发现程序对rsp+0x8这个地址里的值就行了检验，若大于0x7则会跳到<code>Phase_3 &lt;+106&gt;</code>的位置，这个地方会call出引爆炸弹的函数，也就是说，rsp+0x8的位置的值必须小于7</p>
<ul>
<li>对于<code>Phase &lt;+46&gt;</code>的分析</li>
</ul>
<p>当我们顺利通过了检验，便会来到<code>Phase &lt;+46&gt;</code>的位置，这里将rsp+0x8的值给了eax，然后将跳转到<code>[rax*8+0x402470]</code>这个位置</p>
<p>其实这里仔细想一想你会发现rsp+0x8的值是你输入的值，并且这个值被赋给了eax（也就是rax的低32位），也就是说你跳转到的位置是根据你的输入的值乘以8来确定的，如果对于高级语言熟悉的兄弟，应该能猜到，其实从<code>0x0000000000400f71 &lt;+46&gt;:    mov    eax,DWORD PTR [rsp+0x8]</code>这里开始，就是高级语言中的switch语句</p>
<p>也就是说，我们如果输入0，则表达式<code>[rax*8+0x402470]</code>会变为：<code>[0*8+0x402470]</code>，也就是说直接跳转到0x402470这个地址里值的位置。</p>
<p><code>此处为什么并不是直接到0x402470呢？</code></p>
<p>因为在汇编语言中，中括号[]表示的是取括号里地址的值！</p>
<p>那么我们使用gdb的命令<code>x/16x 0x402470</code>来查看0x402470地址里的值，可以发现这个存的地址即为<code>Phase_3 &lt;+57&gt;</code>处的地址，可以发现这个位置将0xcf这个值给了eax，然后跳转到程序结束的位置。</p>
<p>那么到这里，我们需要的密码也就出来了，而且由于是switch分支，此题的答案并不唯一，跟输入有关。</p>
<p>Phase_3的答案为：0 207（207为0xcf的十进制），其他答案请自己动手尝试！</p>
<ul>
<li><strong>Phase_4分析</strong></li>
</ul>
<p>输入命令<code>disassemble phase_4</code>即可得到Phase_4的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040100c &lt;+0&gt;:     sub    rsp,0x18</span><br><span class="line">   0x0000000000401010 &lt;+4&gt;:     lea    rcx,[rsp+0xc]</span><br><span class="line">   0x0000000000401015 &lt;+9&gt;:     lea    rdx,[rsp+0x8]</span><br><span class="line">   0x000000000040101a &lt;+14&gt;:    mov    esi,0x4025cf</span><br><span class="line">   0x000000000040101f &lt;+19&gt;:    mov    eax,0x0</span><br><span class="line">   0x0000000000401024 &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000401029 &lt;+29&gt;:    cmp    eax,0x2</span><br><span class="line">   0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;</span><br><span class="line">   0x000000000040102e &lt;+34&gt;:    cmp    DWORD PTR [rsp+0x8],0xe</span><br><span class="line">   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">   0x0000000000401035 &lt;+41&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040103a &lt;+46&gt;:    mov    edx,0xe</span><br><span class="line">   0x000000000040103f &lt;+51&gt;:    mov    esi,0x0</span><br><span class="line">   0x0000000000401044 &lt;+56&gt;:    mov    edi,DWORD PTR [rsp+0x8]</span><br><span class="line">   0x0000000000401048 &lt;+60&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x000000000040104d &lt;+65&gt;:    test   eax,eax</span><br><span class="line">   0x000000000040104f &lt;+67&gt;:    jne    0x401058 &lt;phase_4+76&gt;</span><br><span class="line">   0x0000000000401051 &lt;+69&gt;:    cmp    DWORD PTR [rsp+0xc],0x0</span><br><span class="line">   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;</span><br><span class="line">   0x0000000000401058 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040105d &lt;+81&gt;:    add    rsp,0x18</span><br><span class="line">   0x0000000000401061 &lt;+85&gt;:    ret</span><br></pre></td></tr></table></figure>

<p>可以看见</p>
<figure class="highlight plaintext"><figcaption><span><+14>:    mov    esi,0x4025cf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  0x000000000040101f &lt;+19&gt;:    mov    eax,0x0</span><br><span class="line">  0x0000000000401024 &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">0x0000000000401029 &lt;+29&gt;:    cmp    eax,0x2</span><br><span class="line">  0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;</span><br></pre></td></tr></table></figure>

<p>这三句话给esi、eax分别赋值为：0x4025cf、0x0，并接受了用户输入，接下来将eax的值与0x2作比较，不相等直接就引爆炸弹</p>
<ul>
<li>对<code>Phase_4 &lt;+34&gt;</code>的分析</li>
</ul>
<p>当我们通过检验后，便会来到<code>Phase_4 &lt;+34&gt;</code>的位置，这里我们需要对以下几句话分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040102e &lt;+34&gt;:    cmp    DWORD PTR [rsp+0x8],0xe</span><br><span class="line">   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">   0x0000000000401035 &lt;+41&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040103a &lt;+46&gt;:    mov    edx,0xe</span><br><span class="line">   0x000000000040103f &lt;+51&gt;:    mov    esi,0x0</span><br><span class="line">   0x0000000000401044 &lt;+56&gt;:    mov    edi,DWORD PTR [rsp+0x8]</span><br><span class="line">   0x0000000000401048 &lt;+60&gt;:    call   0x400fce &lt;func4&gt;</span><br></pre></td></tr></table></figure>

<p>+34的位置，将我们输入的值与0xe比较大小，如果大于了0xe，则会引爆炸弹，那么我们得到了第一个信息：<strong>我们输入的值要小于等于0xe</strong></p>
<p>当通过检验以后，我们会来到+46的位置，这里将edx，esi，edi分别赋值为<strong>0xe，0x0，以及rsp+0x8这个位置的值</strong>，并作为参数进入了func4这个函数，这里请记住他们的值，会在后面的分析中用到</p>
<p><strong>那接下来我们就来分析分析func4这个函数的功能</strong></p>
<p>使用命令<code>disassemble func4</code>来得到func4的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fce &lt;+0&gt;:     sub    rsp,0x8</span><br><span class="line">   0x0000000000400fd2 &lt;+4&gt;:     mov    eax,edx</span><br><span class="line">   0x0000000000400fd4 &lt;+6&gt;:     sub    eax,esi</span><br><span class="line">   0x0000000000400fd6 &lt;+8&gt;:     mov    ecx,eax</span><br><span class="line">   0x0000000000400fd8 &lt;+10&gt;:    shr    ecx,0x1f</span><br><span class="line">   0x0000000000400fdb &lt;+13&gt;:    add    eax,ecx</span><br><span class="line">   0x0000000000400fdd &lt;+15&gt;:    sar    eax,1</span><br><span class="line">   0x0000000000400fdf &lt;+17&gt;:    lea    ecx,[rax+rsi*1]</span><br><span class="line">   0x0000000000400fe2 &lt;+20&gt;:    cmp    ecx,edi</span><br><span class="line">   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;</span><br><span class="line">   0x0000000000400fe6 &lt;+24&gt;:    lea    edx,[rcx-0x1]</span><br><span class="line">   0x0000000000400fe9 &lt;+27&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000400fee &lt;+32&gt;:    add    eax,eax</span><br><span class="line">   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ff2 &lt;+36&gt;:    mov    eax,0x0</span><br><span class="line">   0x0000000000400ff7 &lt;+41&gt;:    cmp    ecx,edi</span><br><span class="line">   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ffb &lt;+45&gt;:    lea    esi,[rcx+0x1]</span><br><span class="line">   0x0000000000400ffe &lt;+48&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000401003 &lt;+53&gt;:    lea    eax,[rax+rax*1+0x1]</span><br><span class="line">   0x0000000000401007 &lt;+57&gt;:    add    rsp,0x8</span><br><span class="line">   0x000000000040100b &lt;+61&gt;:    ret</span><br></pre></td></tr></table></figure>

<p>这个函数我们主要是需要理解这几句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400fdf &lt;+17&gt;:    lea    ecx,[rax+rsi*1]</span><br><span class="line">   0x0000000000400fe2 &lt;+20&gt;:    cmp    ecx,edi</span><br><span class="line">   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;</span><br><span class="line">   0x0000000000400fe6 &lt;+24&gt;:    lea    edx,[rcx-0x1]</span><br><span class="line">   0x0000000000400fe9 &lt;+27&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000400fee &lt;+32&gt;:    add    eax,eax</span><br><span class="line">   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ff2 &lt;+36&gt;:    mov    eax,0x0</span><br><span class="line">   0x0000000000400ff7 &lt;+41&gt;:    cmp    ecx,edi</span><br><span class="line">   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ffb &lt;+45&gt;:    lea    esi,[rcx+0x1]</span><br><span class="line">   0x0000000000400ffe &lt;+48&gt;:    call   0x400fce &lt;func4&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>对<code>func4 &lt;+17&gt;</code>的分析</li>
</ul>
<p>这句话其实乍一看不知道在干什么，其实分析一下这几句话之前的代码会发现，rax此时其实等于（edx-esi）&#x2F;2，那么这句话其实就相当于ecx&#x3D;（edx+esi）&#x2F;2，而这<strong>恰好就是edx+esi的均值</strong>，后面为了方便，我会直接将ecx的值称为均值。这里如果不知道为什么rax等于（edx-esi）&#x2F;2的，可以去复习一下汇编基础。</p>
<p>当赋值完成后，ecx与edi进行了比较，回顾一下前面传了那&#x3D;哪些参数：edx、esi，edi。edi的值是rsp+0x8的值，也就等于用户输入的第一个值，那么这里其实就是将ecx与用户输入的值比较，如果ecx&lt;&#x3D;edi（用户输入），那么edx就等于均值-1，如果ecx&gt;&#x3D;edi，那么edx就等于均值+1。<br>然后回到开始循环，直到用户输入的值，也就是edi，等于均值。那其实这就是一个递归的过程。</p>
<p>这整个函数我们来总结一下就会发现，作用就是用来使用户输入的值等于均值的函数。</p>
<ul>
<li>目前已知信息</li>
</ul>
<p>分析到这里，那么我们现在看看已经得到了哪些信息：</p>
<ol>
<li>输入的值要小于0xe但大于等于0x0</li>
<li>输入的值会被递归判断，最后要能够等于（edx+esi）&#x2F;2</li>
<li>edx与esi的值已知分别为：0xe、0x0，均值为0x7</li>
</ol>
<p>得到这些信息后，我们回到对<code>Phase_4</code>的分析，当func4函数结束后，程序回到了<code>Phase_4 &lt;+65&gt;</code>的位置</p>
<ul>
<li>对<code>Phase_4 &lt;+65&gt;</code>到程序结束的分析</li>
</ul>
<p>这里其实不用多说了，直接看这两句汇编：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmp    DWORD PTR [rsp+0xc],0x0</span><br><span class="line">   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;</span><br></pre></td></tr></table></figure>
<p>这两句话就实现了一个功能，就是确定了我们输入的第二个数必须为0。</p>
<p>那么其实答案已经出来了，并且由于递归的存在，答案并不唯一</p>
<p>Phase_4的答案为：7 0</p>
<p>其他答案的区别仅在于输入后进行递归的次数不同而已</p>
<ul>
<li><strong>Phase_5分析</strong></li>
</ul>
<p>输入命令<code>disassemble phase_5</code>即可得到第五关的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401062 &lt;+0&gt;:     push   rbx</span><br><span class="line">   0x0000000000401063 &lt;+1&gt;:     sub    rsp,0x20</span><br><span class="line">   0x0000000000401067 &lt;+5&gt;:     mov    rbx,rdi</span><br><span class="line">   0x000000000040106a &lt;+8&gt;:     mov    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x0000000000401073 &lt;+17&gt;:    mov    QWORD PTR [rsp+0x18],rax</span><br><span class="line">   0x0000000000401078 &lt;+22&gt;:    xor    eax,eax</span><br><span class="line">   0x000000000040107a &lt;+24&gt;:    call   0x40131b &lt;string_length&gt;</span><br><span class="line">   0x000000000040107f &lt;+29&gt;:    cmp    eax,0x6</span><br><span class="line">   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x0000000000401084 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401089 &lt;+39&gt;:    jmp    0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x000000000040108b &lt;+41&gt;:    movzx  ecx,BYTE PTR [rbx+rax*1]</span><br><span class="line">   0x000000000040108f &lt;+45&gt;:    mov    BYTE PTR [rsp],cl</span><br><span class="line">   0x0000000000401092 &lt;+48&gt;:    mov    rdx,QWORD PTR [rsp]</span><br><span class="line">   0x0000000000401096 &lt;+52&gt;:    and    edx,0xf</span><br><span class="line">   0x0000000000401099 &lt;+55&gt;:    movzx  edx,BYTE PTR [rdx+0x4024b0]</span><br><span class="line">   0x00000000004010a0 &lt;+62&gt;:    mov    BYTE PTR [rsp+rax*1+0x10],dl</span><br><span class="line">   0x00000000004010a4 &lt;+66&gt;:    add    rax,0x1</span><br><span class="line">   0x00000000004010a8 &lt;+70&gt;:    cmp    rax,0x6</span><br><span class="line">   0x00000000004010ac &lt;+74&gt;:    jne    0x40108b &lt;phase_5+41&gt;</span><br><span class="line">   0x00000000004010ae &lt;+76&gt;:    mov    BYTE PTR [rsp+0x16],0x0</span><br><span class="line">   0x00000000004010b3 &lt;+81&gt;:    mov    esi,0x40245e</span><br><span class="line">   0x00000000004010b8 &lt;+86&gt;:    lea    rdi,[rsp+0x10]</span><br><span class="line">   0x00000000004010bd &lt;+91&gt;:    call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x00000000004010c2 &lt;+96&gt;:    test   eax,eax</span><br><span class="line">   0x00000000004010c4 &lt;+98&gt;:    je     0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">   0x00000000004010c6 &lt;+100&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004010cb &lt;+105&gt;:   nop    DWORD PTR [rax+rax*1+0x0]</span><br><span class="line">   0x00000000004010d0 &lt;+110&gt;:   jmp    0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">   0x00000000004010d2 &lt;+112&gt;:   mov    eax,0x0</span><br><span class="line">   0x00000000004010d7 &lt;+117&gt;:   jmp    0x40108b &lt;phase_5+41&gt;</span><br><span class="line">   0x00000000004010d9 &lt;+119&gt;:   mov    rax,QWORD PTR [rsp+0x18]</span><br><span class="line">   0x00000000004010de &lt;+124&gt;:   xor    rax,QWORD PTR fs:0x28</span><br><span class="line">   0x00000000004010e7 &lt;+133&gt;:   je     0x4010ee &lt;phase_5+140&gt;</span><br><span class="line">   0x00000000004010e9 &lt;+135&gt;:   call   0x400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x00000000004010ee &lt;+140&gt;:   add    rsp,0x20</span><br><span class="line">   0x00000000004010f2 &lt;+144&gt;:   pop    rbx</span><br><span class="line">   0x00000000004010f3 &lt;+145&gt;:   ret</span><br></pre></td></tr></table></figure>

<p>这里如果了解对于栈溢出的保护，可以看出这题开了Canary保护，我们从对eax的异或处开始分析</p>
<ul>
<li>对<code>Phase_5 &lt;+22&gt;</code>的分析</li>
</ul>
<p>我们来关注这五句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401078 &lt;+22&gt;:    xor    eax,eax</span><br><span class="line">   0x000000000040107a &lt;+24&gt;:    call   0x40131b &lt;string_length&gt;</span><br><span class="line">   0x000000000040107f &lt;+29&gt;:    cmp    eax,0x6</span><br><span class="line">   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x0000000000401084 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>

<p>第一步将eax异或，也就是将eax清零，然后用了一个函数来计算输入的长度，可以在下一步发现，输入的长度要为0x6，否则就会引爆炸弹。那么我们现在有了密码的第一个线索：<strong>密码的长度为6</strong></p>
<p>当通过这一步检验后，会跳到+112的位置，这里将eax清零后，便跳到了+41的位置，其实经过我们后面的分析，会发现这里其实是一个循环，那现在我们来分析分析，+41的位置干了什么</p>
<ul>
<li>对<code>Phase_5 &lt;+41&gt;</code>的分析</li>
</ul>
<p>对汇编整体一看，就会发现，在后面，只要rax不等于0x6，就会回到+41的位置，可以看出，就是六次循环，那这个循环主要是做什么的呢？我们来看看下面几句话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401092 &lt;+48&gt;:    mov    rdx,QWORD PTR [rsp]</span><br><span class="line">  0x0000000000401096 &lt;+52&gt;:    and    edx,0xf</span><br><span class="line">  0x0000000000401099 &lt;+55&gt;:    movzx  edx,BYTE PTR [rdx+0x4024b0]</span><br></pre></td></tr></table></figure>
<p>这里将我们输入的值赋给了rdx，然后将rdx与0xf与运算，也就是仅保留我们输入的后四位。而在+41的位置<code>0x000000000040108b &lt;+41&gt;:    movzx  ecx,BYTE PTR [rbx+rax*1]</code>这句话，将我们的输入转换为了ASCII码值，那么上面+52位置的作用就是将ASCII码的后四位保留在rdx中。</p>
<p>那么<code>Phase_5 &lt;+55&gt;</code>的位置是做什么的呢？这句话其实就是将我们得到的ASCII码的后四位作为对<code>0x4024b0</code>偏移，来得到新的字符串。因为我们前面分析了，现在的rdx里存放的是ASCII码的后四位，那么+55处的表达式就变为：**[ASCII码的后四位+0x4024b0]**。请记住这个表达式，非常重要。</p>
<p>当循环结束后，就会到<code>Phase_5 &lt;+76&gt;</code>的位置，那我们先来分析分析这里。</p>
<ul>
<li>对<code>Phase_5 &lt;+76&gt;</code>的分析</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004010ae &lt;+76&gt;:    mov    BYTE PTR [rsp+0x16],0x0</span><br><span class="line">   0x00000000004010b3 &lt;+81&gt;:    mov    esi,0x40245e</span><br><span class="line">   0x00000000004010b8 &lt;+86&gt;:    lea    rdi,[rsp+0x10]</span><br><span class="line">   0x00000000004010bd &lt;+91&gt;:    call   0x401338 &lt;strings_not_equal&gt;</span><br></pre></td></tr></table></figure>

<p>其实这里已经很明显了，他将我们前面得到的新字符串，与0x40245e处的字符串作了比较，很显然，0x40245e的字符串就是密码，那我们用命令<code>x/s 0x40245e</code>来看看这个位置有什么。</p>
<p>可以看见，这个位置存放着一个叫‘flyers’的字符串，那么这就是我们需要的密码。但是这里请注意，我们并不能直接输入这个密码，下面来讲讲为什么，以及怎么办。</p>
<ul>
<li>对密码的分析</li>
</ul>
<p>请看我们前面对于+41处的分析，我们会发现，我们输入的值并没有直接与正确答案比较，而是转换得到了一个新的字符串，也就是说，当我们输入了<strong>flyers</strong>后，程序得到的并不是这个字符串，而是转换后的字符串，这就会导致与密码不相等，炸弹爆炸。而前面分析了，我们的输入的ASCII码的后四位保留了下来，并作为偏移，生成了新字符串，前面的表达式还记得吗：**[ASCII码的后四位+0x4024b0]**，下面来讲讲怎么正确的输入</p>
<p>那为了得到正确的字符串，我们需要看看0x4024b0处到底存了什么，输入命令<code>x/s 0x4024b0</code>，可以发现，程序输出了一行字：<code>maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?</code>，那么很显然，我们计算出偏移，就可以得到我们真正需要的字符串，可以发现‘f’处于这句话中的第9个位置（从0开始数），那么f的偏移为9，f的位置就为：**[9+0x4024b0]**，而由于只保留后四位作为偏移，那么我们输入的第一个只要后四位是9即可，这里我选择0x69，那么密码为flyers，我们只需要数一下出每个字母对应的偏移就可以得到我们需要输入的字母的ASCII码值，再转换成字母，即可得到所需要的输入（答案并不唯一），这里给出我的答案，我所选择的都是0x60加上偏移。</p>
<p>phase_5的答案：ionefg</p>
<ul>
<li><strong>Phase_6分析</strong></li>
</ul>
<p>终于到最后一关了，这第六关属实老火，一堆又臭又长的代码（这就是传说中的老六吗），那我们接下来对代码逐步进行分析，使用命令<code>disassemble phase_6</code>，来得到如下的汇编代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#这里到&lt;+93&gt;的位置做的任务是确保输入的六个数字都小于等于6</span><br><span class="line">0x00000000004010f4 &lt;+0&gt;:     push   r14</span><br><span class="line">  0x00000000004010f6 &lt;+2&gt;:     push   r13</span><br><span class="line">  0x00000000004010f8 &lt;+4&gt;:     push   r12</span><br><span class="line">  0x00000000004010fa &lt;+6&gt;:     push   rbp</span><br><span class="line">  0x00000000004010fb &lt;+7&gt;:     push   rbx</span><br><span class="line">  0x00000000004010fc &lt;+8&gt;:     sub    rsp,0x50</span><br><span class="line">  0x0000000000401100 &lt;+12&gt;:    mov    r13,rsp</span><br><span class="line">  0x0000000000401103 &lt;+15&gt;:    mov    rsi,rsp</span><br><span class="line">  0x0000000000401106 &lt;+18&gt;:    call   0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">  0x000000000040110b &lt;+23&gt;:    mov    r14,rsp</span><br><span class="line">  0x000000000040110e &lt;+26&gt;:    mov    r12d,0x0</span><br><span class="line">  0x0000000000401114 &lt;+32&gt;:    mov    rbp,r13</span><br><span class="line">  0x0000000000401117 &lt;+35&gt;:    mov    eax,DWORD PTR [r13+0x0]</span><br><span class="line">  0x000000000040111b &lt;+39&gt;:    sub    eax,0x1</span><br><span class="line">  0x000000000040111e &lt;+42&gt;:    cmp    eax,0x5</span><br><span class="line">  0x0000000000401121 &lt;+45&gt;:    jbe    0x401128 &lt;phase_6+52&gt;</span><br><span class="line">  0x0000000000401123 &lt;+47&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">  0x0000000000401128 &lt;+52&gt;:    add    r12d,0x1</span><br><span class="line">  0x000000000040112c &lt;+56&gt;:    cmp    r12d,0x6</span><br><span class="line">  0x0000000000401130 &lt;+60&gt;:    je     0x401153 &lt;phase_6+95&gt;</span><br><span class="line">  0x0000000000401132 &lt;+62&gt;:    mov    ebx,r12d</span><br><span class="line">  0x0000000000401135 &lt;+65&gt;:    movsxd rax,ebx</span><br><span class="line">  0x0000000000401138 &lt;+68&gt;:    mov    eax,DWORD PTR [rsp+rax*4]</span><br><span class="line">  0x000000000040113b &lt;+71&gt;:    cmp    DWORD PTR [rbp+0x0],eax</span><br><span class="line">  0x000000000040113e &lt;+74&gt;:    jne    0x401145 &lt;phase_6+81&gt;</span><br><span class="line">  0x0000000000401140 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">  0x0000000000401145 &lt;+81&gt;:    add    ebx,0x1</span><br><span class="line">  0x0000000000401148 &lt;+84&gt;:    cmp    ebx,0x5</span><br><span class="line">  0x000000000040114b &lt;+87&gt;:    jle    0x401135 &lt;phase_6+65&gt;</span><br><span class="line">  0x000000000040114d &lt;+89&gt;:    add    r13,0x4</span><br><span class="line">  0x0000000000401151 &lt;+93&gt;:    jmp    0x401114 &lt;phase_6+32&gt;</span><br><span class="line">#这里到&lt;+121&gt;的位置主要是对输入的数字，进行了运算：输入=7-输入</span><br><span class="line">  0x0000000000401153 &lt;+95&gt;:    lea    rsi,[rsp+0x18]</span><br><span class="line">  0x0000000000401158 &lt;+100&gt;:   mov    rax,r14</span><br><span class="line">  0x000000000040115b &lt;+103&gt;:   mov    ecx,0x7</span><br><span class="line">  0x0000000000401160 &lt;+108&gt;:   mov    edx,ecx</span><br><span class="line">  0x0000000000401162 &lt;+110&gt;:   sub    edx,DWORD PTR [rax]</span><br><span class="line">  0x0000000000401164 &lt;+112&gt;:   mov    DWORD PTR [rax],edx</span><br><span class="line">  0x0000000000401166 &lt;+114&gt;:   add    rax,0x4</span><br><span class="line">  0x000000000040116a &lt;+118&gt;:   cmp    rax,rsi</span><br><span class="line">  0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;</span><br><span class="line">  0x000000000040116f &lt;+123&gt;:   mov    esi,0x0</span><br><span class="line">  0x0000000000401174 &lt;+128&gt;:   jmp    0x401197 &lt;phase_6+163&gt;</span><br><span class="line">  0x0000000000401176 &lt;+130&gt;:   mov    rdx,QWORD PTR [rdx+0x8]</span><br><span class="line">  0x000000000040117a &lt;+134&gt;:   add    eax,0x1</span><br><span class="line">  0x000000000040117d &lt;+137&gt;:   cmp    eax,ecx</span><br><span class="line">  0x000000000040117f &lt;+139&gt;:   jne    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">  0x0000000000401181 &lt;+141&gt;:   jmp    0x401188 &lt;phase_6+148&gt;</span><br><span class="line">  0x0000000000401183 &lt;+143&gt;:   mov    edx,0x6032d0</span><br><span class="line">  0x0000000000401188 &lt;+148&gt;:   mov    QWORD PTR [rsp+rsi*2+0x20],rdx</span><br><span class="line">  0x000000000040118d &lt;+153&gt;:   add    rsi,0x4</span><br><span class="line">  0x0000000000401191 &lt;+157&gt;:   cmp    rsi,0x18</span><br><span class="line">  0x0000000000401195 &lt;+161&gt;:   je     0x4011ab &lt;phase_6+183&gt;</span><br><span class="line">  0x0000000000401197 &lt;+163&gt;:   mov    ecx,DWORD PTR [rsp+rsi*1]</span><br><span class="line">  0x000000000040119a &lt;+166&gt;:   cmp    ecx,0x1</span><br><span class="line">  0x000000000040119d &lt;+169&gt;:   jle    0x401183 &lt;phase_6+143&gt;</span><br><span class="line">  0x000000000040119f &lt;+171&gt;:   mov    eax,0x1</span><br><span class="line">  0x00000000004011a4 &lt;+176&gt;:   mov    edx,0x6032d0</span><br><span class="line">  0x00000000004011a9 &lt;+181&gt;:   jmp    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">  0x00000000004011ab &lt;+183&gt;:   mov    rbx,QWORD PTR [rsp+0x20]</span><br><span class="line">  0x00000000004011b0 &lt;+188&gt;:   lea    rax,[rsp+0x28]</span><br><span class="line">  0x00000000004011b5 &lt;+193&gt;:   lea    rsi,[rsp+0x50]</span><br><span class="line">  0x00000000004011ba &lt;+198&gt;:   mov    rcx,rbx</span><br><span class="line">  0x00000000004011bd &lt;+201&gt;:   mov    rdx,QWORD PTR [rax]</span><br><span class="line">  0x00000000004011c0 &lt;+204&gt;:   mov    QWORD PTR [rcx+0x8],rdx</span><br><span class="line">  0x00000000004011c4 &lt;+208&gt;:   add    rax,0x8</span><br><span class="line">  0x00000000004011c8 &lt;+212&gt;:   cmp    rax,rsi</span><br><span class="line">  0x00000000004011cb &lt;+215&gt;:   je     0x4011d2 &lt;phase_6+222&gt;</span><br><span class="line">  0x00000000004011cd &lt;+217&gt;:   mov    rcx,rdx</span><br><span class="line">  0x00000000004011d0 &lt;+220&gt;:   jmp    0x4011bd &lt;phase_6+201&gt;</span><br><span class="line">  0x00000000004011d2 &lt;+222&gt;:   mov    QWORD PTR [rdx+0x8],0x0</span><br><span class="line">  0x00000000004011da &lt;+230&gt;:   mov    ebp,0x5</span><br><span class="line">  0x00000000004011df &lt;+235&gt;:   mov    rax,QWORD PTR [rbx+0x8]</span><br><span class="line">  0x00000000004011e3 &lt;+239&gt;:   mov    eax,DWORD PTR [rax]</span><br><span class="line">  0x00000000004011e5 &lt;+241&gt;:   cmp    DWORD PTR [rbx],eax</span><br><span class="line">  0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">  0x00000000004011e9 &lt;+245&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">  0x00000000004011ee &lt;+250&gt;:   mov    rbx,QWORD PTR [rbx+0x8]</span><br><span class="line">  0x00000000004011f2 &lt;+254&gt;:   sub    ebp,0x1</span><br><span class="line">  0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;</span><br><span class="line">  0x00000000004011f7 &lt;+259&gt;:   add    rsp,0x50</span><br><span class="line">  0x00000000004011fb &lt;+263&gt;:   pop    rbx</span><br><span class="line">  0x00000000004011fc &lt;+264&gt;:   pop    rbp</span><br><span class="line">  0x00000000004011fd &lt;+265&gt;:   pop    r12</span><br><span class="line">  0x00000000004011ff &lt;+267&gt;:   pop    r13</span><br><span class="line">  0x0000000000401201 &lt;+269&gt;:   pop    r14</span><br><span class="line">  0x0000000000401203 &lt;+271&gt;:   ret</span><br></pre></td></tr></table></figure>

<p>从前面我对代码的注释，可以知道<code>phase_6 &lt;+0&gt;</code>到<code>phase_6 &lt;+121&gt;</code>的功能，这两部分，并不难理解，这里就不在赘述了。</p>
<p>而从121开始，后面的代码，我第一次看的时候完全不知所云，直到我发现了一个地址：<code>0x0000000000401183 &lt;+143&gt;:   mov    edx,0x6032d0</code>，在+143的地方有这样一个地址，抱着试一试的心态，我输入命令<code>x/x 0x6032d0</code>,查看了该地址里的值，发现是这样的一个值<code>0x6032d0 &lt;node1&gt;:       0x4c</code>，好家伙，看见前面的node1了吗，这时候我们心里其实可以大胆的猜测一下，从&lt;+121&gt;的位置往后，其实是构建了一个链表结构，node1表示第一个节点，那我们现在有了这个想法以后，再来看看这段代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov    rax,QWORD PTR [rbx+0x8]</span><br><span class="line">   0x00000000004011e3 &lt;+239&gt;:   mov    eax,DWORD PTR [rax]</span><br><span class="line">   0x00000000004011e5 &lt;+241&gt;:   cmp    DWORD PTR [rbx],eax</span><br><span class="line">   0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;</span><br></pre></td></tr></table></figure>
<p>这一段话里，我们可以看见，如果rbx的值小于了eax的值，则会引爆炸弹，那我们看看rbx和eax代表着什么，可以往这几句话之前看，可以看见，分别是当前节点的值，和下一节点的值，那么其实这里就是要求了当前节点的值要大于下一节点的值，那么可以知道链表是根据节点值，从大到小排列，那我们来看看链表的值，输入命令<code>x/24w 0x6032d0</code>,可以看见，输出了六个节点，而根据我对代码的注释，可以发现，只能输入六个值，也就是说，链表只能有六个节点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x6032d0 &lt;node1&gt;:       0x0000014c      0x00000001      0x006032e0      0x00000000</span><br><span class="line">0x6032e0 &lt;node2&gt;:       0x000000a8      0x00000002      0x006032f0      0x00000000</span><br><span class="line">0x6032f0 &lt;node3&gt;:       0x0000039c      0x00000003      0x00603300      0x00000000</span><br><span class="line">0x603300 &lt;node4&gt;:       0x000002b3      0x00000004      0x00603310      0x00000000</span><br><span class="line">0x603310 &lt;node5&gt;:       0x000001dd      0x00000005      0x00603320      0x00000000</span><br><span class="line">0x603320 &lt;node6&gt;:       0x000001bb      0x00000006      0x00000000      0x00000000</span><br></pre></td></tr></table></figure>

<p>那么我们根据六个节点的值，来对其排序，可以得到，最后的顺序为：node3&gt;node4&gt;node5&gt;node6&gt;node1&gt;node2，那么密码就是：3 4 5 6 1 2，但是，同样的，由于前面的代码对我们输入的数字进行了运算：输入&#x3D;7-输入，所以我们在输入的时候要先用7减去密码。</p>
<p>phase_6的答案为：4 3 2 1 6 5</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/posts/7948c3fd/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Nemu-Wp
          
        </div>
      </a>
    
    
      <a href="/posts/4aae578b/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">CISCN2022-Duck</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022-2023
        <i class="ri-heart-fill heart_icon"></i> h1J4cker
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/h1J4cker.svg" alt="h1J4cker&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>